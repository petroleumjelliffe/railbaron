<html>
<head>
<title>Rail Baron 2013</title>
<link rel="stylesheet" href="css/styles2.css">
<link rel="stylesheet" href="css/flapper.css">


<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes" />  
<meta name="apple-mobile-web-app-status-bar-style" content="black" />  
<style>

.region-letter, .city-letter, #payout {
  display: none;
}
</style>
</head>



<body>
  <div id="board">
  <h1 id="title">Rail Baron</h1>





<div class="display"><h2>Region</h2>
<input id="region-display" />

<table id="region">
  <tr>
    <td class="region-letter"> </td>
    <td class="region-letter"> </td>
    <td class="region-letter">R</td>
    <td class="region-letter">a</td>
    <td class="region-letter">i</td>
    <td class="region-letter">l</td>
    <td class="region-letter"> </td>
    <td class="region-letter">B</td>
    <td class="region-letter">a</td>
    <td class="region-letter">r</td>
    <td class="region-letter">o</td>
    <td class="region-letter">n</td>
    <td class="region-letter"> </td>
    <td class="region-letter"> </td>
  </tr>
</table>
<form>


      <input type="button" disabled="disabled" class="region-selector" id="region-1" value="Northeast" > 
  <input type="button" disabled="disabled" class="region-selector" id="region-2" value="Southeast">
  <input type="button" disabled="disabled" class="region-selector" id="region-3" value="North Central">
  <input type="button" disabled="disabled" class="region-selector" id="region-4" value="South Central"> 
  <input type="button" disabled="disabled" class="region-selector" id="region-5" value="Plains">
  <input type="button" disabled="disabled" class="region-selector" id="region-6" value="Northwest"> 
  <input type="button" disabled="disabled" class="region-selector" id="region-7" value="Southwest"> 
</form>
</div>

<div class="display">

<h2>City</h2>
<input id="city-display" />

<table id="city">
  <tr>
    <td class="city-letter"> </td>
    <td class="city-letter"> </td>
    <td class="city-letter"> </td>
    <td class="city-letter"> </td>
    <td class="city-letter"> </td>
    <td class="city-letter">2</td>
    <td class="city-letter">0</td>
    <td class="city-letter">1</td>
    <td class="city-letter">3</td>
    <td class="city-letter"> </td>
    <td class="city-letter"> </td>
    <td class="city-letter"> </td>
    <td class="city-letter"> </td>
    <td class="city-letter"> </td>
  </tr>

</table>
</div>    


<div class="display"><h2>Payout</h2>
<input id="payout-display" />

<table id="payout">
  <tr>
    <td>$</td>
    <td class="payout-letter"> </td>
    <td class="payout-letter"> </td>
    <td class="payout-letter">0</td>
    <td class="payout-letter">0</td>
    <td class="payout-letter">0</td>
  </tr>
  
</table>
</div>

</div>
  
  <div id="buttons">
  <ul>
    <li><a href="#" class="destination-button" id="red"><span class="city">tap to join</span><br /> <span class="payout">Red</span> </a>      </li>
    <li><a href="#" class="destination-button" id="blue" > <span class="city">tap to join</span><br /> <span class="payout">Blue</span></a>   </li>
    <li><a href="#" class="destination-button" id="green"> <span class="city">tap to join</span><br /> <span class="payout">Green</span></a>  </li>
    <li><a href="#" class="destination-button" id="yellow"><span class="city">tap to join</span><br /> <span class="payout">Yellow</span></a></li>
    <li><a href="#" class="destination-button" id="black"> <span class="city">tap to join</span><br /> <span class="payout">Black</span></a>  </li>
    <li><a href="#" class="destination-button" id="white"> <span class="city">tap to join</span><br /> <span class="payout">White</span></a>  </li>
  </ul>

</div>
<input id="display" />

  
<script src="jquery-1.8.3.min.js" type="text/javascript"></script>
<script src="modernizr.custom.47689.js" type="text/javascript"></script>
<script src="js/railbaronv2.js" type="text/javascript"></script>
<script src="js/jquery.flapper.js" type="text/javascript"></script>
<script>


//VIEW SPECIFIC FUNCTIONS - FLIPPY

var game= new RailBaronController();


 
var updateButton= function(color, city, payout) {
  console.log(color, city, payout);
  $("#"+color+" span.city").text(city); 
  
  if (payout !== "Home") {
    payout= "$"+ payout; 
  }
  $("#"+color+" span.payout").text(payout); 
};

 
var updateFlippy= function(selector, label) {
  var alpha="abcdefghijklmnopqrstuvwxyz1234567890., ";

  $(selector).fadeOut(1000, function() {
//    console.log("label:"+label);
    label.toLowerCase();

    $(selector).each(function(index) {
      var a= $(this).text();
      a.toLowerCase();
      //if panel needs to be updated for this word
        
      var b= label.charAt(index)||" ";
      
      if (a !== b) {
//        console.log("this.text="+$(this).text());
          
          
          $(this).text(b);
      }
      
    }); 

    $(this).show();

  });
}; 

var selectRegion= function(that) {
//use that.data to access passed object
          console.log("hide ");
  
  //event.color, callback, region
  game.playerAddDestination(that.data.player.getColor(), updateBoard, that.data.region);
          $(".region-selector").hide();
          $(".region-selector").prop("disabled",true);

  
};

  
//callback function for add destination (rewrite as if/then)
var updateBoard= function (result) {

console.log(this);


//'this' refers to the player who triggered the function 
  switch (result) {
      case "new": //player added
          
          //activate button
          $("#"+this.getColor()).toggleClass("add");
          
          //update flippys with destination
/*
          updateFlippy(".region-letter", this.getRegion());
          updateFlippy(".city-letter", this.getCity());
          updateFlippy(".payout-letter", this.getPayout());
*/
          
    $("#region-display").val(this.getRegion().toUpperCase()).change();
    $("#city-display").val(this.getCity().toUpperCase()).change();
    $("#payout-display").val(this.getPayout().toUpperCase()).change();
    
    console.log(this.getRegion().toUpperCase());
          //update button
          updateButton(this.getColor(), this.getCity(), this.getPayout());        

        break;
      case "added":
      
          //disable region selector if it's visble
           $(".region-selector").hide();
          $(".region-selector").prop("disabled",true);
         
          
          //update flippys with destination
/*
          updateFlippy(".region-letter", this.getRegion());
          updateFlippy(".city-letter", this.getCity());
          updateFlippy(".payout-letter", this.getPayout());
*/
    $("#region-display").val(this.getRegion().toUpperCase()).change();
    $("#city-display").val(this.getCity().toUpperCase()).change();
    $("#payout-display").val(this.getPayout()).change();

          //update button
          
          updateButton(this.getColor(), this.getCity(), this.getPayout());        

        break;
      case "ask":
        //display the region selector
/*
        updateFlippy(".region-letter", "Choose region");
        updateFlippy(".city-letter", " ");
*/
    $("#region-display").val("CHOOSE REGION").change();
        
        $(".region-selector").show();
        $(".region-selector").prop("disabled",false);

        
        var that={};
        that.color= this.getColor();
        that.callback= updateBoard;
         //store ref to player
         console.log(that.color);
         
        
        //when a region selector button is clicked, call get destination on the player in this callback
        $(".region-selector").each(function (index){
          that.region=index;
          var obj={};
          obj["color"]= that.color;
          obj["callback"]=updateBoard;
          obj["region"]=index;
          
          $(this).off( "click");
          $(this).click(obj, game.playerAddDestination);
        });
        break;
        
    
    }
};

  console.log(game);
  /* alert(toLowerCase("A")); */
  
  
  $(document).ready(function(){
    
    
    //set each palyer button onclick
    $(".destination-button").each(function() {
        //set button to create a player, that corresponds to the ID
      var color= $(this).attr("id");
      
      //set each button's function
      $(this).click({"color":color,"callback":updateBoard}, game.playerAddDestination);
      
      
      });

var destinationOptions = {
  width: 14,             // number of digits
  format: null,         // options for jquery.numberformatter, if loaded
  align: 'left',       // aligns values to the left or right of display
  padding: '&nbsp;',    // value to use for padding
  chars: null,          // array of characters that Flapper can display
  chars_preset: 'alphanum',  // 'num', 'hexnum', 'alpha' or 'alphanum'
  timing: 250,          // the maximum timing for digit animation
  min_timing: 10,       // the minimum timing for digit animation
  threshhold: 100,      // the point at which Flapper will switch from
                        // simple to detailed animations
  transform: true       // Flapper automatically detects the jquery.transform
                        // plugin. Set this to false if you want to force
                        // transform to off
}
var payoutOptions = {
  width: 6,             // number of digits
  format: null,         // options for jquery.numberformatter, if loaded
  align: 'left',       // aligns values to the left or right of display
  padding: '&nbsp;',    // value to use for padding
  chars: null,          // array of characters that Flapper can display
  chars_preset: 'alphanum',  // 'num', 'hexnum', 'alpha' or 'alphanum'
  timing: 250,          // the maximum timing for digit animation
  min_timing: 10,       // the minimum timing for digit animation
  threshhold: 100,      // the point at which Flapper will switch from
                        // simple to detailed animations
  transform: true       // Flapper automatically detects the jquery.transform
                        // plugin. Set this to false if you want to force
                        // transform to off
}
        
    //region
    $("#region-display").flapper(destinationOptions).val("RAIL BARON").change();
    $("#city-display").flapper(destinationOptions).val("2014").change();
    $("#payout-display").flapper(payoutOptions).val("PXJ").change();
        

      
    });
  

</script>



</body>

</html>